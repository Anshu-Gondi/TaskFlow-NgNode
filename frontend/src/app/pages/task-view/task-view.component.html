<div class="centered-content">
  <div class="task-manager-container columns is-gapless is-multiline">
    <!-- Sidebar -->
    <div class="column is-full-mobile is-one-quarter-desktop sidebar">
      <h1 class="title has-text-warning has-background-white">LISTS</h1>

      <div class="list-menu">
        <a
          class="list-menu-item"
          *ngFor="let list of lists"
          [routerLink]="['/lists', list._id]"
          [routerLinkActive]="['is-active']"
          [routerLinkActiveOptions]="{ exact: true }"
        >
          <p>{{ list.title }}</p>
        </a>
      </div>

      <button
        class="button is-primary has-text-white is-fullwidth"
        [routerLink]="['/new-list']"
      >
        + New List
      </button>

      <ng-container *ngIf="listId">
        <a
          class="button is-warning is-fullwidth"
          style="margin-top: 10px"
          [routerLink]="['/lists', listId, 'ai-scheduler']"
        >
          üîÆ AI Scheduler
        </a>
      </ng-container>
    </div>

    <!-- Main Content -->
    <div class="column is-full-mobile is-three-quarters-desktop tasks-list-container">
      <!-- Top Bar: Filter & Sort -->
      <div class="columns is-mobile is-multiline is-vcentered mb-4">
        <div class="column is-half-mobile is-one-third-tablet">
          <div class="select is-small is-fullwidth">
            <select [(ngModel)]="filterPriority">
              <option value="">All Priorities</option>
              <option value="0">Low</option>
              <option value="1">Medium</option>
              <option value="2">High</option>
              <option value="3">Urgent</option>
            </select>
          </div>
        </div>
        <div class="column is-half-mobile is-one-third-tablet">
          <button class="button is-small is-fullwidth" (click)="sortByDueDate()">
            Sort by Due Date {{ sortAsc ? '‚Üë' : '‚Üì' }}
          </button>
        </div>
      </div>

      <!-- Tasks Area -->
    <div class="top-bar">
      <h1 class="title has-text-warning">TASKS</h1>
      <div class="dropdown is-hoverable is-right" *ngIf="listId">
        <div class="dropdown-trigger">
          <button class="button" aria-haspopup="true" aria-controls="dropdown-menu4">
            <span class="icon is-small">
              <i class="fas fa-cog" aria-hidden="true"></i>
            </span>
          </button>
        </div>
        <div class="dropdown-menu" id="dropdown-menu4" role="menu">
          <div class="dropdown-content">
            <a class="dropdown-item" [routerLink]="['/edit-list', listId]">Edit</a>
            <a (click)="onDeleteListClick()" class="dropdown-item has-text-danger">
              Delete
            </a>
          </div>
        </div>
      </div>
    </div>


      <!-- Task Cards -->
      <div
        class="task"
        *ngFor="let task of filteredTasks"
        (click)="onTaskClick(task)"
        [ngClass]="{ completed: task.completed }"
      >
        <div class="task-text">
          <div class="task-info">
            <p class="task-title has-text-weight-bold">{{ task.title }}</p>
            <p class="task-meta">
              <span
                *ngIf="task.priority !== undefined"
                class="tag is-rounded"
                [ngClass]="priorityClass(task.priority)"
              >
                {{ priorityLabel(task.priority) }}
              </span>
              <span *ngIf="task.dueDate">üìÖ {{ task.dueDate | date : 'MMM d, y' }}</span>
              <span *ngIf="task.completed" class="tag is-success is-light">‚úÖ Done</span>
              <span
                *ngIf="isOverdue(task.dueDate) && !task.completed"
                class="tag is-danger is-light"
              >
                ‚è∞ Overdue
              </span>
            </p>
          </div>
          <div class="task-buttons">
            <button class="button" (click)="onTaskEditClick(task)">
              <span class="icon"><i class="fas fa-edit"></i></span>
            </button>
            <button class="button is-danger" (click)="givem(task._id)">
              <span class="icon"><i class="fas fa-trash"></i></span>
            </button>
          </div>
        </div>
      </div>

      <!-- Add Task -->
      <div class="add-task-container has-text-centered mt-5">
        <button
          class="button circle-add-button has-text-white is-link"
          [routerLink]="['/lists', listId, 'new-task']"
        >
          <img src="/plus-icon.svg" alt="Add Icon" style="width: 20px; height: 20px" />
        </button>
      </div>

      <!-- Fallback -->
      <ng-template #fallbackState>
        <div class="fallback-container">
          <h2 class="subtitle has-text-grey has-text-centered">
            {{ listId ? 'No tasks available' : 'No list selected' }}
          </h2>
        </div>
      </ng-template>
    </div>
  </div>
</div>
