<div class="centered-content">
  <div class="task-manager-container columns is-gapless is-multiline">
    <!-- Sidebar -->
    <div class="column is-full-mobile is-one-quarter-desktop sidebar">
      <h1 class="title has-text-warning has-background-white">LISTS</h1>

      <div class="list-menu">
        <div
          class="list-menu-item is-flex is-justify-content-space-between is-align-items-center"
          *ngFor="let list of lists"
        >
          <a
            class="is-flex-grow-1"
            [routerLink]="getListLink(list._id)"
            routerLinkActive="is-active"
            [routerLinkActiveOptions]="{ exact: true }"
          >
            <p>{{ list.title }}</p>
          </a>

          <!-- Cog Dropdown for each list -->
          <div class="dropdown is-right is-hoverable is-small">
            <div class="dropdown-trigger">
              <button
                class="button is-white is-small"
                aria-haspopup="true"
                aria-controls="dropdown-menu"
              >
                <span class="icon is-small">
                  <i class="fas fa-cog"></i>
                </span>
              </button>
            </div>
            <div class="dropdown-menu" role="menu">
              <div class="dropdown-content">
                <a
                  class="dropdown-item"
                  [routerLink]="linkToEditList(list._id)"
                >
                  ‚úèÔ∏è Edit
                </a>
                <a
                  class="dropdown-item has-text-danger"
                  (click)="deleteList(list._id)"
                >
                  üóë Delete
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>

      <button
        class="button is-primary has-text-white is-fullwidth"
        [routerLink]="getNewListLink()"
      >
        + New List
      </button>

      <ng-container *ngIf="listId">
        <a
          class="button is-warning is-fullwidth mt-2"
          [routerLink]="getAiSchedulerLink()"
        >
          üîÆ AI Scheduler
        </a>
      </ng-container>

      <!-- ‚úÖ Team Members (only in team view) -->
      <ng-container *ngIf="teamId">
        <button
          class="button is-link is-fullwidth mt-2"
          (click)="toggleMembers()"
        >
          üë• Members
        </button>
      </ng-container>

      <!-- Switch Workspace Button -->
      <ng-container>
        <button
          class="button is-light is-fullwidth mt-2"
          (click)="switchWorkspace()"
        >
          üîÑ Switch Workspace
        </button>
      </ng-container>
    </div>

    <!-- Main Content -->
    <div
      class="column is-full-mobile is-three-quarters-desktop tasks-list-container"
    >
      <!-- Top Bar -->
      <div class="columns is-mobile is-multiline is-vcentered mb-4">
        <div class="column is-half-mobile is-one-third-tablet">
          <div class="select is-small is-fullwidth">
            <select [(ngModel)]="filterPriority">
              <option value="">All Priorities</option>
              <option value="0">Low</option>
              <option value="1">Medium</option>
              <option value="2">High</option>
              <option value="3">Urgent</option>
            </select>
          </div>
        </div>
        <div class="column is-half-mobile is-one-third-tablet">
          <button
            class="button is-small is-fullwidth"
            (click)="sortByDueDate()"
          >
            Sort by Due Date {{ sortAsc ? "‚Üë" : "‚Üì" }}
          </button>
        </div>
      </div>

      <!-- Task Cards -->
      <h1 class="title has-text-warning">TASKS</h1>
      <div
        class="task"
        *ngFor="let task of filteredTasks"
        (click)="onTaskClick(task)"
        [ngClass]="{ completed: task.completed }"
      >
        <div class="task-text">
          <div class="task-info">
            <p class="task-title has-text-weight-bold">{{ task.title }}</p>
            <p class="task-meta">
              <span
                *ngIf="task.priority !== undefined"
                class="tag is-rounded"
                [ngClass]="priorityClass(task.priority)"
              >
                {{ priorityLabel(task.priority) }}
              </span>
              <span *ngIf="task.dueDate"
                >üìÖ {{ task.dueDate | date : "MMM d, y" }}</span
              >
              <span *ngIf="task.completed" class="tag is-success is-light"
                >‚úÖ Done</span
              >
              <span
                *ngIf="isOverdue(task.dueDate) && !task.completed"
                class="tag is-danger is-light"
                >‚è∞ Overdue</span
              >
            </p>
          </div>
          <div class="task-buttons">
            <button class="button" (click)="onTaskEditClick(task)">
              <span class="icon"><i class="fas fa-edit"></i></span>
            </button>
            <button class="button is-danger" (click)="deleteTask(task._id)">
              <span class="icon"><i class="fas fa-trash"></i></span>
            </button>
          </div>
        </div>
      </div>

      <!-- Add Task Button -->
      <div class="add-task-container has-text-centered mt-5">
        <button
          class="button circle-add-button has-text-white is-link"
          [routerLink]="getNewTaskLink()"
        >
          <img
            src="/plus-icon.svg"
            alt="Add Icon"
            style="width: 20px; height: 20px"
          />
        </button>
      </div>

      <!-- Fallback -->
      <ng-template #fallbackState>
        <div class="fallback-container">
          <h2 class="subtitle has-text-grey has-text-centered">
            {{ listId ? "No tasks available" : "No list selected" }}
          </h2>
        </div>
      </ng-template>
    </div>
  </div>
</div>
